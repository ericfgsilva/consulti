!function($){"use strict";function TagsInput(element,options){this.itemsArray=[],this.$element=$(element),this.$element.hide(),this.isSelect="SELECT"===element.tagName,this.multiple=this.isSelect&&element.hasAttribute("multiple"),this.objectItems=options&&options.itemValue,this.placeholderText=element.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=$('<div class="bootstrap-tagsinput"></div>'),this.$input=$('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container),this.build(options)}function makeOptionItemFunction(options,key){if("function"!=typeof options[key]){var propertyName=options[key];options[key]=function(item){return item[propertyName]}}}function makeOptionFunction(options,key){if("function"!=typeof options[key]){var value=options[key];options[key]=function(){return value}}}function htmlEncode(value){return value?htmlEncodeContainer.text(value).html():""}function doGetCaretPosition(oField){var iCaretPos=0;if(document.selection){oField.focus();var oSel=document.selection.createRange();oSel.moveStart("character",-oField.value.length),iCaretPos=oSel.text.length}else(oField.selectionStart||"0"==oField.selectionStart)&&(iCaretPos=oField.selectionStart);return iCaretPos}var defaultOptions={tagClass:function(){return"label label-info"},itemValue:function(item){return item?item.toString():item},itemText:function(item){return this.itemValue(item)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(item,$tag){$tag.hide().fadeIn()}};TagsInput.prototype={constructor:TagsInput,add:function(item,dontPushVal){var self=this;if(!(self.options.maxTags&&self.itemsArray.length>=self.options.maxTags||item!==!1&&!item)){if("object"==typeof item&&!self.objectItems)throw"Can't add objects when itemValue option is not set";if(!item.toString().match(/^\s*$/)){if(self.isSelect&&!self.multiple&&self.itemsArray.length>0&&self.remove(self.itemsArray[0]),"string"==typeof item&&"INPUT"===this.$element[0].tagName){var items=item.split(",");if(items.length>1){for(var i=0;i<items.length;i++)this.add(items[i],!0);return void(dontPushVal||self.pushVal())}}var itemValue=self.options.itemValue(item),itemText=self.options.itemText(item),tagClass=self.options.tagClass(item),existing=$.grep(self.itemsArray,function(item){return self.options.itemValue(item)===itemValue})[0];if(existing){if(self.options.onTagExists){var $existingTag=$(".tag",self.$container).filter(function(){return $(this).data("item")===existing});self.options.onTagExists(item,$existingTag)}}else{self.itemsArray.push(item);var $tag=$('<span class="tag '+htmlEncode(tagClass)+'">'+htmlEncode(itemText)+'<span data-role="remove"></span></span>');if($tag.data("item",item),self.findInputWrapper().before($tag),$tag.after(" "),self.isSelect&&!$('option[value="'+escape(itemValue)+'"]',self.$element)[0]){var $option=$("<option selected>"+htmlEncode(itemText)+"</option>");$option.data("item",item),$option.attr("value",itemValue),self.$element.append($option)}dontPushVal||self.pushVal(),self.options.maxTags===self.itemsArray.length&&self.$container.addClass("bootstrap-tagsinput-max"),self.$element.trigger($.Event("itemAdded",{item:item}))}}}},remove:function(item,dontPushVal){var self=this;self.objectItems&&(item="object"==typeof item?$.grep(self.itemsArray,function(other){return self.options.itemValue(other)==self.options.itemValue(item)})[0]:$.grep(self.itemsArray,function(other){return self.options.itemValue(other)==item})[0]),item&&($(".tag",self.$container).filter(function(){return $(this).data("item")===item}).remove(),$("option",self.$element).filter(function(){return $(this).data("item")===item}).remove(),self.itemsArray.splice($.inArray(item,self.itemsArray),1)),dontPushVal||self.pushVal(),self.options.maxTags>self.itemsArray.length&&self.$container.removeClass("bootstrap-tagsinput-max"),self.$element.trigger($.Event("itemRemoved",{item:item}))},removeAll:function(){var self=this;for($(".tag",self.$container).remove(),$("option",self.$element).remove();self.itemsArray.length>0;)self.itemsArray.pop();self.pushVal(),self.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var self=this;$(".tag",self.$container).each(function(){var $tag=$(this),item=$tag.data("item"),itemValue=self.options.itemValue(item),itemText=self.options.itemText(item),tagClass=self.options.tagClass(item);if($tag.attr("class",null),$tag.addClass("tag "+htmlEncode(tagClass)),$tag.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=htmlEncode(itemText),self.isSelect){var option=$("option",self.$element).filter(function(){return $(this).data("item")===item});option.attr("value",itemValue)}})},items:function(){return this.itemsArray},pushVal:function(){var self=this,val=$.map(self.items(),function(item){return self.options.itemValue(item).toString()});self.$element.val(val,!0).trigger("change")},build:function(options){var self=this;self.options=$.extend({},defaultOptions,options);var typeahead=self.options.typeahead||{};self.objectItems&&(self.options.freeInput=!1),makeOptionItemFunction(self.options,"itemValue"),makeOptionItemFunction(self.options,"itemText"),makeOptionItemFunction(self.options,"tagClass"),self.options.source&&(typeahead.source=self.options.source),typeahead.source&&$.fn.typeahead&&(makeOptionFunction(typeahead,"source"),self.$input.typeahead({source:function(query,process){function processItems(items){for(var texts=[],i=0;i<items.length;i++){var text=self.options.itemText(items[i]);map[text]=items[i],texts.push(text)}process(texts)}this.map={};var map=this.map,data=typeahead.source(query);$.isFunction(data.success)?data.success(processItems):$.when(data).then(processItems)},updater:function(text){self.add(this.map[text])},matcher:function(text){return-1!==text.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(texts){return texts.sort()},highlighter:function(text){var regex=new RegExp("("+this.query+")","gi");return text.replace(regex,"<strong>$1</strong>")}})),self.$container.on("click",$.proxy(function(){self.$input.focus()},self)),self.$container.on("keydown","input",$.proxy(function(event){var $input=$(event.target),$inputWrapper=self.findInputWrapper();switch(event.which){case 8:if(0===doGetCaretPosition($input[0])){var prev=$inputWrapper.prev();prev&&self.remove(prev.data("item"))}break;case 46:if(0===doGetCaretPosition($input[0])){var next=$inputWrapper.next();next&&self.remove(next.data("item"))}break;case 37:var $prevTag=$inputWrapper.prev();0===$input.val().length&&$prevTag[0]&&($prevTag.before($inputWrapper),$input.focus());break;case 39:var $nextTag=$inputWrapper.next();0===$input.val().length&&$nextTag[0]&&($nextTag.after($inputWrapper),$input.focus());break;default:self.options.freeInput&&$.inArray(event.which,self.options.confirmKeys)>=0&&(self.add($input.val()),$input.val(""),event.preventDefault())}$input.attr("size",Math.max(this.inputSize,$input.val().length))},self)),self.$container.on("click","[data-role=remove]",$.proxy(function(event){self.remove($(event.target).closest(".tag").data("item"))},self)),self.options.itemValue===defaultOptions.itemValue&&("INPUT"===self.$element[0].tagName?self.add(self.$element.val()):$("option",self.$element).each(function(){self.add($(this).attr("value"),!0)}))},destroy:function(){var self=this;self.$container.off("keypress","input"),self.$container.off("click","[role=remove]"),self.$container.remove(),self.$element.removeData("tagsinput"),self.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var elt=this.$input[0],container=this.$container[0];elt&&elt.parentNode!==container;)elt=elt.parentNode;return $(elt)}},$.fn.tagsinput=function(arg1,arg2){var results=[];return this.each(function(){var tagsinput=$(this).data("tagsinput");if(tagsinput){var retVal=tagsinput[arg1](arg2);void 0!==retVal&&results.push(retVal)}else tagsinput=new TagsInput(this,arg1),$(this).data("tagsinput",tagsinput),results.push(tagsinput),"SELECT"===this.tagName&&$("option",$(this)).attr("selected","selected"),$(this).val($(this).val())}),"string"==typeof arg1?results.length>1?results:results[0]:results},$.fn.tagsinput.Constructor=TagsInput;var htmlEncodeContainer=$("<div />");$(function(){$("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);