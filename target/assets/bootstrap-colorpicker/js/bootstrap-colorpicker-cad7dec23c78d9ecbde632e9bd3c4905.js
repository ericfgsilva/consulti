!function($){var Color=function(val){this.value={h:1,s:1,b:1,a:1},this.setColor(val)};Color.prototype={constructor:Color,setColor:function(val){val=val.toLowerCase();var that=this;$.each(CPGlobal.stringParsers,function(i,parser){var match=parser.re.exec(val),values=match&&parser.parse(match),space=parser.space||"rgba";return values?(that.value="hsla"===space?CPGlobal.RGBtoHSB.apply(null,CPGlobal.HSLtoRGB.apply(null,values)):CPGlobal.RGBtoHSB.apply(null,values),!1):!0})},setHue:function(h){this.value.h=1-h},setSaturation:function(s){this.value.s=s},setLightness:function(b){this.value.b=1-b},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(h,s,b,a){h||(h=this.value.h,s=this.value.s,b=this.value.b),h*=360;var R,G,B,X,C;return h=h%360/60,C=b*s,X=C*(1-Math.abs(h%2-1)),R=G=B=b-C,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],{r:Math.round(255*R),g:Math.round(255*G),b:Math.round(255*B),a:a||this.value.a}},toHex:function(h,s,b,a){var rgb=this.toRGB(h,s,b,a);return"#"+(1<<24|parseInt(rgb.r)<<16|parseInt(rgb.g)<<8|parseInt(rgb.b)).toString(16).substr(1)},toHSL:function(h,s,b,a){h||(h=this.value.h,s=this.value.s,b=this.value.b);var H=h,L=(2-s)*b,S=s*b;return S/=L>0&&1>=L?L:2-L,L/=2,S>1&&(S=1),{h:H,s:S,l:L,a:a||this.value.a}}};var _guid=0,Colorpicker=function(element,options){_guid++,this.element=$(element).attr("data-colorpicker-guid",_guid);var format=options.format||this.element.data("color-format")||"hex";this.format=CPGlobal.translateFormats[format],this.isInput=this.element.is("input"),this.component=this.element.is(".colorpicker-component")?this.element.find(".add-on, .input-group-addon"):!1,this.picker=$(CPGlobal.template).attr("data-colorpicker-guid",_guid).appendTo("body").on("mousedown.colorpicker",$.proxy(this.mousedown,this)),this.isInput?this.element.on({"focus.colorpicker":$.proxy(this.show,this),"keyup.colorpicker":$.proxy(this.update,this)}):this.component?this.component.on({"click.colorpicker":$.proxy(this.show,this)}):this.element.on({"click.colorpicker":$.proxy(this.show,this)}),("rgba"===format||"hsla"===format)&&(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update(),$($.proxy(function(){this.element.trigger("create",[this])},this))};Colorpicker.prototype={constructor:Colorpicker,show:function(e){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),$(window).on("resize.colorpicker",$.proxy(this.place,this)),this.isInput||e&&(e.stopPropagation(),e.preventDefault()),$(document).on({"mousedown.colorpicker":$.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color})},update:function(){var color=this.isInput?this.element.prop("value"):this.element.data("color");("undefined"==typeof color||null===color)&&(color="#ffffff"),this.color=new Color(color),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},hide:function(){this.picker.hide(),$(window).off("resize",this.place),$(document).off({mousedown:this.hide}),this.isInput?""!==this.element.val()&&this.element.prop("value",this.format.call(this)).trigger("change"):(this.component&&""!==this.element.find("input").val()&&this.element.find("input").prop("value",this.format.call(this)).trigger("change"),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hidePicker",color:this.color})},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left})},destroy:function(){$(".colorpicker[data-colorpicker-guid="+this.element.attr("data-colorpicker-guid")+"]").remove(),this.element.removeData("colorpicker").removeAttr("data-colorpicker-guid").off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.trigger("destroy",[this])},setValue:function(value){this.isInput?this.element.prop("value",value):(this.element.find("input").val(value),this.element.data("color",value)),this.update(),this.element.trigger({type:"changeColor",color:this.color})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(e){e.stopPropagation(),e.preventDefault();var target=$(e.target),zone=target.closest("div");if(!zone.is(".colorpicker")){if(zone.is(".colorpicker-saturation"))this.slider=$.extend({},CPGlobal.sliders.saturation);else if(zone.is(".colorpicker-hue"))this.slider=$.extend({},CPGlobal.sliders.hue);else{if(!zone.is(".colorpicker-alpha"))return!1;this.slider=$.extend({},CPGlobal.sliders.alpha)}var offset=zone.offset();this.slider.knob=zone.find("i")[0].style,this.slider.left=e.pageX-offset.left,this.slider.top=e.pageY-offset.top,this.pointer={left:e.pageX,top:e.pageY},$(document).on({"mousemove.colorpicker":$.proxy(this.mousemove,this),"mouseup.colorpicker":$.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){e.stopPropagation(),e.preventDefault();var left=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((e.pageX||this.pointer.left)-this.pointer.left))),top=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((e.pageY||this.pointer.top)-this.pointer.top)));if(this.slider.knob.left=left+"px",this.slider.knob.top=top+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,left/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,top/100),this.previewColor(),this.isInput)try{this.element.val(this.format.call(this)).trigger("change")}catch(e){this.element.val(this.color.toHex()).trigger("change")}else try{this.element.find("input").val(this.format.call(this)).trigger("change")}catch(e){this.element.find("input").val(this.color.toHex()).trigger("change")}return this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(e){return e.stopPropagation(),e.preventDefault(),$(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},$.fn.colorpicker=function(option,value){return this.each(function(){var $this=$(this),data=$this.data("colorpicker"),options="object"==typeof option&&option;data?"string"==typeof option&&data[option](value):"destroy"!==option&&$this.data("colorpicker",data=new Colorpicker(this,$.extend({},$.fn.colorpicker.defaults,options)))})},$.fn.colorpicker.defaults={},$.fn.colorpicker.Constructor=Colorpicker;var CPGlobal={translateFormats:{rgb:function(){var rgb=this.color.toRGB();return"rgb("+rgb.r+","+rgb.g+","+rgb.b+")"},rgba:function(){var rgb=this.color.toRGB();return"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+rgb.a+")"},hsl:function(){var hsl=this.color.toHSL();return"hsl("+Math.round(360*hsl.h)+","+Math.round(100*hsl.s)+"%,"+Math.round(100*hsl.l)+"%)"},hsla:function(){var hsl=this.color.toHSL();return"hsla("+Math.round(360*hsl.h)+","+Math.round(100*hsl.s)+"%,"+Math.round(100*hsl.l)+"%,"+hsl.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(r,g,b,a){r/=255,g/=255,b/=255;var H,S,V,C;return V=Math.max(r,g,b),C=V-Math.min(r,g,b),H=0===C?null:V===r?(g-b)/C:V===g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,S=0===C?0:C/V,{h:H||1,s:S,b:V,a:a||1}},HueToRGB:function(p,q,h){return 0>h?h+=1:h>1&&(h-=1),1>6*h?p+(q-p)*h*6:1>2*h?q:2>3*h?p+(q-p)*(2/3-h)*6:p},HSLtoRGB:function(h,s,l,a){0>s&&(s=0);var q;q=.5>=l?l*(1+s):l+s-l*s;var p=2*l-q,tr=h+1/3,tg=h,tb=h-1/3,r=Math.round(255*CPGlobal.HueToRGB(p,q,tr)),g=Math.round(255*CPGlobal.HueToRGB(p,q,tg)),b=Math.round(255*CPGlobal.HueToRGB(p,q,tb));return[r,g,b,a||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[2.55*execResult[1],2.55*execResult[2],2.55*execResult[3],execResult[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1]/360,execResult[2]/100,execResult[3]/100,execResult[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery);