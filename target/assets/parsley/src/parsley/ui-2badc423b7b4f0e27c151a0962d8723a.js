define("parsley/ui",["parsley/utils"],function(){var ParsleyUI=function(){this.__class__="ParsleyUI"};return ParsleyUI.prototype={listen:function(){return $.listen("parsley:form:init",this,this.setupForm),$.listen("parsley:field:init",this,this.setupField),$.listen("parsley:field:validated",this,this.reflow),$.listen("parsley:form:validated",this,this.focus),$.listen("parsley:field:reset",this,this.reset),$.listen("parsley:form:destroy",this,this.destroy),$.listen("parsley:field:destroy",this,this.destroy),this},reflow:function(fieldInstance){if("undefined"!=typeof fieldInstance._ui&&!1!==fieldInstance._ui.active){var diff=this._diff(fieldInstance.validationResult,fieldInstance._ui.lastValidationResult);fieldInstance._ui.lastValidationResult=fieldInstance.validationResult,fieldInstance._ui.validatedOnce=!0,this.manageStatusClass(fieldInstance),this.manageErrorsMessages(fieldInstance,diff),this.actualizeTriggers(fieldInstance),(diff.kept.length||diff.added.length)&&"undefined"==typeof fieldInstance._ui.failedOnce&&this.manageFailingFieldTrigger(fieldInstance)}},getErrorsMessages:function(fieldInstance){if(!0===fieldInstance.validationResult)return[];for(var messages=[],i=0;i<fieldInstance.validationResult.length;i++)messages.push(this._getErrorMessage(fieldInstance,fieldInstance.validationResult[i].assert));return messages},manageStatusClass:function(fieldInstance){!0===fieldInstance.validationResult?this._successClass(fieldInstance):fieldInstance.validationResult.length>0?this._errorClass(fieldInstance):this._resetClass(fieldInstance)},manageErrorsMessages:function(fieldInstance,diff){if("undefined"==typeof fieldInstance.options.errorsMessagesDisabled){if("undefined"!=typeof fieldInstance.options.errorMessage)return diff.added.length||diff.kept.length?(0===fieldInstance._ui.$errorsWrapper.find(".parsley-custom-error-message").length&&fieldInstance._ui.$errorsWrapper.append($(fieldInstance.options.errorTemplate).addClass("parsley-custom-error-message")),fieldInstance._ui.$errorsWrapper.addClass("filled").find(".parsley-custom-error-message").html(fieldInstance.options.errorMessage)):fieldInstance._ui.$errorsWrapper.removeClass("filled").find(".parsley-custom-error-message").remove();for(var i=0;i<diff.removed.length;i++)this.removeError(fieldInstance,diff.removed[i].assert.name,!0);for(i=0;i<diff.added.length;i++)this.addError(fieldInstance,diff.added[i].assert.name,void 0,diff.added[i].assert,!0);for(i=0;i<diff.kept.length;i++)this.updateError(fieldInstance,diff.kept[i].assert.name,void 0,diff.kept[i].assert,!0)}},addError:function(fieldInstance,name,message,assert,doNotUpdateClass){fieldInstance._ui.$errorsWrapper.addClass("filled").append($(fieldInstance.options.errorTemplate).addClass("parsley-"+name).html(message||this._getErrorMessage(fieldInstance,assert))),!0!==doNotUpdateClass&&this._errorClass(fieldInstance)},updateError:function(fieldInstance,name,message,assert,doNotUpdateClass){fieldInstance._ui.$errorsWrapper.addClass("filled").find(".parsley-"+name).html(message||this._getErrorMessage(fieldInstance,assert)),!0!==doNotUpdateClass&&this._errorClass(fieldInstance)},removeError:function(fieldInstance,name,doNotUpdateClass){fieldInstance._ui.$errorsWrapper.removeClass("filled").find(".parsley-"+name).remove(),!0!==doNotUpdateClass&&this.manageStatusClass(fieldInstance)},focus:function(formInstance){if(!0===formInstance.validationResult||"none"===formInstance.options.focus)return formInstance._focusedField=null;formInstance._focusedField=null;for(var i=0;i<formInstance.fields.length;i++)if(!0!==formInstance.fields[i].validationResult&&formInstance.fields[i].validationResult.length>0&&"undefined"==typeof formInstance.fields[i].options.noFocus){if("first"===formInstance.options.focus)return formInstance._focusedField=formInstance.fields[i].$element,formInstance._focusedField.focus();formInstance._focusedField=formInstance.fields[i].$element}return null===formInstance._focusedField?null:formInstance._focusedField.focus()},_getErrorMessage:function(fieldInstance,constraint){var customConstraintErrorMessage=constraint.name+"Message";return"undefined"!=typeof fieldInstance.options[customConstraintErrorMessage]?window.ParsleyValidator.formatMessage(fieldInstance.options[customConstraintErrorMessage],constraint.requirements):window.ParsleyValidator.getErrorMessage(constraint)},_diff:function(newResult,oldResult,deep){for(var added=[],kept=[],i=0;i<newResult.length;i++){for(var found=!1,j=0;j<oldResult.length;j++)if(newResult[i].assert.name===oldResult[j].assert.name){found=!0;break}found?kept.push(newResult[i]):added.push(newResult[i])}return{kept:kept,added:added,removed:deep?[]:this._diff(oldResult,newResult,!0).added}},setupForm:function(formInstance){formInstance.$element.on("submit.Parsley",!1,$.proxy(formInstance.onSubmitValidate,formInstance)),!1!==formInstance.options.uiEnabled&&formInstance.$element.attr("novalidate","")},setupField:function(fieldInstance){var _ui={active:!1};!1!==fieldInstance.options.uiEnabled&&(_ui.active=!0,fieldInstance.$element.attr(fieldInstance.options.namespace+"id",fieldInstance.__id__),_ui.$errorClassHandler=this._manageClassHandler(fieldInstance),_ui.errorsWrapperId="parsley-id-"+("undefined"!=typeof fieldInstance.options.multiple?"multiple-"+fieldInstance.options.multiple:fieldInstance.__id__),_ui.$errorsWrapper=$(fieldInstance.options.errorsWrapper).attr("id",_ui.errorsWrapperId),_ui.lastValidationResult=[],_ui.validatedOnce=!1,_ui.validationInformationVisible=!1,fieldInstance._ui=_ui,this._insertErrorWrapper(fieldInstance),this.actualizeTriggers(fieldInstance))},_manageClassHandler:function(fieldInstance){if("string"==typeof fieldInstance.options.classHandler&&$(fieldInstance.options.classHandler).length)return $(fieldInstance.options.classHandler);var $handler=fieldInstance.options.classHandler(fieldInstance);return"undefined"!=typeof $handler&&$handler.length?$handler:"undefined"==typeof fieldInstance.options.multiple||fieldInstance.$element.is("select")?fieldInstance.$element:fieldInstance.$element.parent()},_insertErrorWrapper:function(fieldInstance){var $errorsContainer;if("string"==typeof fieldInstance.options.errorsContainer){if($(fieldInstance.options.errorsContainer+"").length)return $(fieldInstance.options.errorsContainer).append(fieldInstance._ui.$errorsWrapper);window.console&&window.console.warn&&window.console.warn("The errors container `"+fieldInstance.options.errorsContainer+"` does not exist in DOM")}return"function"==typeof fieldInstance.options.errorsContainer&&($errorsContainer=fieldInstance.options.errorsContainer(fieldInstance)),"undefined"!=typeof $errorsContainer&&$errorsContainer.length?$errorsContainer.append(fieldInstance._ui.$errorsWrapper):"undefined"==typeof fieldInstance.options.multiple?fieldInstance.$element.after(fieldInstance._ui.$errorsWrapper):fieldInstance.$element.parent().after(fieldInstance._ui.$errorsWrapper)},actualizeTriggers:function(fieldInstance){var that=this;if(fieldInstance.options.multiple?$("["+fieldInstance.options.namespace+'multiple="'+fieldInstance.options.multiple+'"]').each(function(){$(this).off(".Parsley")}):fieldInstance.$element.off(".Parsley"),!1!==fieldInstance.options.trigger){var triggers=fieldInstance.options.trigger.replace(/^\s+/g,"").replace(/\s+$/g,"");""!==triggers&&(fieldInstance.options.multiple?$("["+fieldInstance.options.namespace+'multiple="'+fieldInstance.options.multiple+'"]').each(function(){$(this).on(triggers.split(" ").join(".Parsley ")+".Parsley",!1,$.proxy("function"==typeof fieldInstance.eventValidate?fieldInstance.eventValidate:that.eventValidate,fieldInstance))}):fieldInstance.$element.on(triggers.split(" ").join(".Parsley ")+".Parsley",!1,$.proxy("function"==typeof fieldInstance.eventValidate?fieldInstance.eventValidate:this.eventValidate,fieldInstance)))}},eventValidate:function(event){new RegExp("key").test(event.type)&&!this._ui.validationInformationVisible&&this.getValue().length<=this.options.validationThreshold||(this._ui.validatedOnce=!0,this.validate())},manageFailingFieldTrigger:function(fieldInstance){return fieldInstance._ui.failedOnce=!0,fieldInstance.options.multiple&&$("["+fieldInstance.options.namespace+'multiple="'+fieldInstance.options.multiple+'"]').each(function(){return new RegExp("change","i").test($(this).parsley().options.trigger||"")?void 0:$(this).on("change.ParsleyFailedOnce",!1,$.proxy(fieldInstance.validate,fieldInstance))}),fieldInstance.$element.is("select")&&!new RegExp("change","i").test(fieldInstance.options.trigger||"")?fieldInstance.$element.on("change.ParsleyFailedOnce",!1,$.proxy(fieldInstance.validate,fieldInstance)):new RegExp("keyup","i").test(fieldInstance.options.trigger||"")?void 0:fieldInstance.$element.on("keyup.ParsleyFailedOnce",!1,$.proxy(fieldInstance.validate,fieldInstance))},reset:function(parsleyInstance){parsleyInstance.$element.off(".Parsley"),parsleyInstance.$element.off(".ParsleyFailedOnce"),"undefined"!=typeof parsleyInstance._ui&&"ParsleyForm"!==parsleyInstance.__class__&&(parsleyInstance._ui.$errorsWrapper.children().each(function(){$(this).remove()}),this._resetClass(parsleyInstance),parsleyInstance._ui.validatedOnce=!1,parsleyInstance._ui.lastValidationResult=[],parsleyInstance._ui.validationInformationVisible=!1)},destroy:function(parsleyInstance){this.reset(parsleyInstance),"ParsleyForm"!==parsleyInstance.__class__&&(parsleyInstance._ui.$errorsWrapper.remove(),delete parsleyInstance._ui)},_successClass:function(fieldInstance){fieldInstance._ui.validationInformationVisible=!0,fieldInstance._ui.$errorClassHandler.removeClass(fieldInstance.options.errorClass).addClass(fieldInstance.options.successClass)},_errorClass:function(fieldInstance){fieldInstance._ui.validationInformationVisible=!0,fieldInstance._ui.$errorClassHandler.removeClass(fieldInstance.options.successClass).addClass(fieldInstance.options.errorClass)},_resetClass:function(fieldInstance){fieldInstance._ui.$errorClassHandler.removeClass(fieldInstance.options.successClass).removeClass(fieldInstance.options.errorClass)}},ParsleyUI});