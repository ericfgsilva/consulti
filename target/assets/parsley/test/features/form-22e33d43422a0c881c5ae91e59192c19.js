define(function(){return function(ParsleyForm,Parsley){describe("ParsleyForm",function(){it("should be a function",function(){expect(ParsleyForm).to.be.a("function")}),it("should throw an error if no element given",function(){expect(ParsleyForm).to.throwException()}),it("should bind parsleyFields children",function(){$("body").append('<form id="element"><input id="field1" type="text"/><div id="field2"></div><textarea id="field2"></textarea></form>');var parsleyForm=new Parsley($("#element"));expect(parsleyForm.fields.length).to.be(2)}),it("should bind parsleyFields children, and not excluded ones",function(){$("body").append('<form id="element"><input id="field1" type="text"/><div id="field2"></div><textarea id="field2"></textarea><div data-parsley-validate></div><input id="field3" disabled /><input type="submit"/></form>');var parsleyForm=new Parsley($("#element"),{excluded:"[disabled], input[type=button], input[type=submit], input[type=reset]"});expect(parsleyForm.fields.length).to.be(2)}),it("should properly bind options for form and children fields",function(){$("body").append('<form id="element" data-parsley-trigger="change"><input id="field1" type="text" data-parsley-required="true" /><div id="field2"></div><textarea id="field3" data-parsley-notblank="true"></textarea></form>');var parsleyForm=new Parsley($("#element"));expect(parsleyForm.fields.length).to.be(2),expect(new Parsley("#field1").options.trigger).to.be("change"),expect(new Parsley("#field1").options).to.have.key("required"),expect(new Parsley("#field1").options).to.not.have.key("notblank"),expect(new Parsley("#field3").options).to.have.key("notblank"),expect(new Parsley("#field3").options).to.not.have.key("required")}),it("should properly store validation state after `validate()`",function(){$("body").append('<form id="element" data-parsley-trigger="change"><input id="field1" type="text" data-parsley-required="true" /><div id="field2"></div><textarea id="field3" data-parsley-notblank="true"></textarea></form>');var parsleyForm=new Parsley($("#element"));parsleyForm.validate(),expect(parsleyForm.validationResult).to.be(!1),$("#field1").val("foo"),$("#field3").val("foo"),expect(parsleyForm.validate()).to.be(!0)}),it("should handle group validation",function(){$("body").append('<form id="element"><input id="field1" type="text" data-parsley-group="foo" data-parsley-required="true" /><div id="field2"></div><textarea id="field3" data-parsley-group="bar" data-parsley-required="true"></textarea></form>');var parsleyForm=new Parsley($("#element"));expect(parsleyForm.isValid()).to.be(!1),$("#field1").val("value"),expect(parsleyForm.isValid()).to.be(!1),expect(parsleyForm.isValid("foo")).to.be(!0),expect(parsleyForm.isValid("bar")).to.be(!1)}),it("should handle `onFormSubmit` validation",function(){$("body").append('<form id="element" data-parsley-trigger="change"><input id="field1" type="text" data-parsley-required="true" /><div id="field2"></div><textarea id="field3" data-parsley-notblank="true"></textarea></form>');var parsleyForm=new Parsley($("#element"));parsleyForm.subscribe("parsley:form:validate",function(formInstance){formInstance.asyncSupport&&formInstance.submitEvent._originalPreventDefault()});var event=$.Event();event._originalPreventDefault=event.preventDefault,event.preventDefault=sinon.spy(),parsleyForm.onSubmitValidate(event),expect(event.preventDefault.called).to.be(!0),$("#field1").val("foo"),$("#field3").val("foo"),event=$.Event(),event._originalPreventDefault=event.preventDefault,event.preventDefault=sinon.spy(),parsleyForm.onSubmitValidate(event),expect(event.preventDefault.called).to.be(parsleyForm.asyncSupport?!0:!1)}),it("should have a force option for validate and isValid methods",function(){$("body").append('<form id="element"><input id="field1" type="email" /><input id="field3" data-parsley-notblank="true" /></form>'),expect($("#element").parsley().isValid()).to.be(!0),expect($("#element").parsley().isValid(void 0,!0)).to.be(!1),expect($("#element").parsley().validate()).to.be(!0),expect($("#element").parsley().validate(void 0,!0)).to.be(!1)}),it("should properly bind dynamically added fields",function(){$("body").append('<form id="element" data-parsley-trigger="change"></form>'),$("#element").append('<input type="email" id="email" required />');var fieldInstance=$("#email").psly();expect(fieldInstance.__class__).to.be("ParsleyField");var formInstance=$("#element").psly();expect(formInstance.fields[0].$element.attr("id")).to.be("email"),expect(fieldInstance.parent.__class__).to.be("ParsleyForm")}),it("should stop event propagation on form submit",function(done){$("body").append('<form id="element"><input type="text" required/></form>');var parsleyInstance=$("#element").parsley();$("#element").on("submit",function(){expect(!0).to.be(!1)}),parsleyInstance.subscribe("parsley:form:validated",function(){done()}),$("#element").submit()}),afterEach(function(){$("#element").length&&$("#element").remove()})})}});